# network-protection
Защита сети

**Межсетевые экраны**

Межсетевой экран (файрвол, firewall; брандмауэр, brandmauer) — программный или программно-аппаратный модуль, осуществляющий блокирование сетевого трафика по заданным правилам или алгоритмам.

Типы межсетевых экранов:
- пакетный фильтр
- stateful firewall
- firewall NG

**Система Обнаружения Вторжений (Intrusion Detection System, IDS)** — программное или аппаратное решение, определяющее вредоносную активность в системе или сетевом трафике.

**Система Предотвращения Вторжений (Intrusion Prevention Systems, IPS)** — программное или аппаратное решение, предотвращающее вредоносную активность в системе или сетевом трафике

**СОВ: типы СОВ**

По подключению:
- сетевая СОВ (Network-based IDS, NIDS)
- локальная СОВ (Host-based IDS, HIDS)
По методу обнаружения аномалий:
- сигнатурный поиск (Signature-based detection)
- статистическое определение аномалий (Statistical anomaly-based detection)

**СОВ: недостатки СОВ**
- Наличие ложно-позитивных срабатываний
- Необходимо постоянное обновление правил
- Существует временной лаг между появлением уязвимостей и созданием правил для их обнаружения
- Невозможна обработка зашифрованного трафика
- Почти невозможно определить уязвимости, вызванные неправильной настройкой: слабая аутентификации и т. д

**Suricata** — сетевая IDS с открытым исходным кодом, разрабатываемая Open Security Foundation (OISF)
- Сайт: suricata-ids.org
- Исходный код: github.com/OISF/suricata

**Suricata: установка**
```
user@user:~$ sudo apt install software-properties-common
user@user:~$ sudo add-apt-repository ppa:oisf/suricata-stable
user@user:~$ sudo apt update
user@user:~$ sudo apt install suricata
user@user:~$ sudo suricata-update
```
Проверка установки:
```
user@user:~$ sudo systemctl status suricata
```
**Suricata: настройка**
```
user@user:~$ sudo nano /etc/suricata/suricata.yaml
```
И меняем значение параметра EXTERNAL_NET на "any"
```
user@user:~$ sudo systemctl restart suricata
```
Лог-файлы:
```
user@user:~$ sudo tail /var/log/suricata/suricata.log
user@user:~$ sudo tail /var/log/suricata/stats.log
```
**Suricata: запуск**
```
ubuntu@ubuntu:~$ sudo suricata -c /etc/suricata/suricata.yaml -i enp0s8 - где параметр “i” указывает прослушиваемый интерфейс
```
откроем лог-файл, в котором будут отображаться предупреждения:
```
ubuntu@ubuntu:~$ sudo tail -f /var/log/suricata/fast.log
```

**ARP-spoofing** — атака, использующая особенность протокола ARP, которая позволяет обработать ARP-ответ без предварительного ARP- запроса. Протокол ARP не сохраняет своё состояние, stateless protocol.
Такая атака позволяет злоумышленнику перехватывать трафик между узлами локальной сети и является разновидностью MITM-атак (Man In The Middle, человек посередине)

**MITM** (Man In The Middle, человек посередине, атака посредника) — атака, в результате которой атакующий скрытно принимает и передаёт информацию между двумя узлами. При этом атакуемые узлы считают, что общаются друг с другом напряму

**ARP-spoofing: статические arp-записи**

Плюсы:
- записи, добавленные в ARP-таблицу вручную, имеют приоритет над динамическими
- протокол ARP можно вообще отключить
Минусы:
- на каждом хосте нужно создать ARP-таблицу из N-1 записей
- при каждой замене оборудования или подключении нового, нужно перенастраивать все хосты

**ARP-spoofing: защита на уровне ядра ОС**

Для ядер Linux/FreeBSD существует патч, позволяющий значительно понизить вероятность успешного выполнения ARP-spoofing.

Метод состоит в следующем:
1. При изменении MAC-адрес посылается ARP-запрос, требующий всем хостам сообщить свои MAC-адреса
2. Если выполняется атака, то по дублированию ответов она будет обнаружена
3. Если изменение MAC-адреса произошло стандартно, то ответа, содержащего старый MAC-адрес, не будет

**ARP-spoofing: VLAN**

Разбиение сети при помощи VLAN не предотвращает атаку ARP-spoofing, но ограничивает её развитие. ARP-запросы не могут переходить из одного VLAN в другой. Частным случаем, неприменимым в реальных офисных сетях, является создание VLAN на каждый порт коммутатора и добавление в него только одного хоста. В такой ситуации ARP-spoofing не имеет смысла.

**ARP-spoofing: DAI**

Динамическая проверка ARP (Dynamic ARP inspection, DAI) — функция защиты от ARP-атак на стороне коммутатора. Для правильной работы DAI на коммутаторе необходимо указать доверенные (другой коммутатор) и ненадёжные (клиенты) порты.

Коммутатор проверяет соответствие IP- и MAC-адресов на ненадёжных портах по:
- базе данных DHCP
- статическим записям

**ARP-spoofing: защита на прикладном уровне**
- XArp — программа, отслеживающая соответствие между IP и MAC- адресами. В случае обнаружения несоответствия, сообщает об этом пользователю.
- XArp сначала анализирует ARP-таблицу, запоминает все полученные ARP-ответы и создаёт свою собственную таблицу IP- и MAC-адресов. Если это соответствие нарушается или в сети появляются новые адреса, об этом будет выдано сообщение в системный журнал. Защиты на прикладном уровне лучше всего запускать на SPAN- интерфейсе

**Fail2Ban: ограничение скорости перебора**

Самым простым решением ограничения скорости перебора паролей, является ограничение в доступе, или бан, для адреса, с которого производится атака.

Для решения этой задачи существуют:
- Fail2Ban
- ipban
- DenyHosts

**Fail2Ban** — одна из узкоспециализированных систем обнаружения вторжений (СОВ, Intrusion Prevention Software, IPS). Fail2Ban сканирует лог-файлы, находит в них странное сетевое поведение, например, ошибки набора пароля, и блокирует подозрительные адреса IP-адреса на заданное время

**Web-трафик**
- Web-трафик сейчас составляет большую часть трафика в корпоративных сетях
- Web-трафик бывает двух типов:
- - исходящий — сотрудники компании выходят в интернет
- - входящий — пользователи из интернета подключаются к публикуемым web-порталам

**Защита исходящего трафика**

Для защиты исходящего трафика применяются прокси-сервера. Типовые функции: работа с HTTPs, антивирус, URL фильтрация (категории сайтов), возможность фильтрации по типу файлов

**Защита входящего трафика**

Для защиты входящего web-трафика применяются Web Application Firewall (WAF):
- обеспечивает комплексную защиту от атак на веб-приложения
- учитывает логику работы веб-приложений: сессии, cookies и т. д.
- защищает веб-приложения лучше межсетевых экранов и систем обнаружения вторжений
- предоставляет защиту от веб-атак: SQL-инъекций, межсайтового скриптинга, небезопасных конфигураций и т. д.
- определяет и блокирует уязвимости веб-приложений — «виртуальный патчинг»

**Honeypot (приманка, ловушка)** — система, предназначенная для обнаружения компьютерных атак через имитацию работы реальной системы

**Honeypot: типы**
- Полная эмуляция системы (Pure honeypot)
- Высокоинтерактивные (High-interaction honeypot)
- Низкоинтерактивные (Low-interaction honeypot)

**Honeypot: недостатки**
- Если ловушка плохо настроена, её легко распознать
- Ловушка может обнаружить только атаку на саму ловушку
- Если ловушка распознана, на неё можно совершить «атаку», чтобы отвлечь от реальных действий в системе
- Если ловушка содержит уязвимости, через неё можно атаковать систему
